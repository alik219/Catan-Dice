<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Catan Dice Roller</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: 20px;
      touch-action: pan-y;
    }
    
    h1 {
      color: white;
      margin-bottom: 30px;
      font-size: 28px;
      text-align: center;
    }
    
    .dice-container {
      display: flex;
      gap: 15px;
      margin-bottom: 30px;
      flex-wrap: wrap;
      justify-content: center;
    }
    
    .die-wrapper {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 10px;
    }
    
    .die {
      width: 90px;
      height: 90px;
      background: white;
      border-radius: 15px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 48px;
      font-weight: bold;
      box-shadow: 0 8px 16px rgba(0,0,0,0.3);
      cursor: pointer;
      user-select: none;
      touch-action: none;
      transition: transform 0.1s;
    }
    
    .die:active {
      transform: scale(0.95);
    }
    
    .die.rolling {
      animation: shake 0.5s ease-in-out;
    }
    
    @keyframes shake {
      0%, 100% { transform: rotate(0deg); }
      10% { transform: rotate(-5deg) translateX(-5px); }
      20% { transform: rotate(5deg) translateX(5px); }
      30% { transform: rotate(-5deg) translateX(-5px); }
      40% { transform: rotate(5deg) translateX(5px); }
      50% { transform: rotate(-5deg) translateX(-5px); }
      60% { transform: rotate(5deg) translateX(5px); }
      70% { transform: rotate(-5deg) translateX(-5px); }
      80% { transform: rotate(5deg) translateX(5px); }
      90% { transform: rotate(-5deg) translateX(-5px); }
    }
    
    .die.red {
      background: linear-gradient(135deg, #ff6b6b 0%, #ee5a6f 100%);
      color: white;
    }
    
    .die.yellow {
      background: linear-gradient(135deg, #ffd93d 0%, #f6c23e 100%);
      color: #333;
    }
    
    .die.event {
      background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
      color: white;
      font-size: 32px;
      padding: 10px;
    }
    
    .event-icon {
      width: 60px;
      height: 60px;
      object-fit: contain;
    }
    
    .die-label {
      color: white;
      font-size: 14px;
      font-weight: 600;
      text-align: center;
    }
    
    .pips {
      display: grid;
      grid-template: repeat(3, 1fr) / repeat(3, 1fr);
      gap: 8px;
      padding: 15px;
    }
    
    .pip {
      width: 12px;
      height: 12px;
      background: currentColor;
      border-radius: 50%;
    }
    
    button {
      background: white;
      border: none;
      padding: 15px 40px;
      border-radius: 30px;
      font-size: 18px;
      font-weight: bold;
      color: #667eea;
      cursor: pointer;
      box-shadow: 0 4px 12px rgba(0,0,0,0.2);
      transition: transform 0.1s, box-shadow 0.1s;
    }
    
    button:active {
      transform: translateY(2px);
      box-shadow: 0 2px 8px rgba(0,0,0,0.2);
    }
    
    .swipe-hint {
      color: rgba(255,255,255,0.8);
      font-size: 14px;
      margin-top: 20px;
      text-align: center;
    }
    
    .result-text {
      position: absolute;
      left: -9999px;
    }
  </style>
</head>
<body>
  <h1>ðŸŽ² Catan Dice Roller</h1>
  
  <div class="dice-container">
    <div class="die-wrapper">
      <div class="die red" id="red-die" role="img" aria-label="Red die">
        <div class="pips" id="red-pips"></div>
      </div>
      <div class="die-label">Red Die</div>
      <div class="result-text" id="red-result" aria-live="polite"></div>
    </div>
    
    <div class="die-wrapper">
      <div class="die yellow" id="yellow-die" role="img" aria-label="Yellow die">
        <div class="pips" id="yellow-pips"></div>
      </div>
      <div class="die-label">Yellow Die</div>
      <div class="result-text" id="yellow-result" aria-live="polite"></div>
    </div>
    
    <div class="die-wrapper">
      <div class="die event" id="event-die" role="img" aria-label="Event die">
        <img id="event-face" class="event-icon" src="images/ship.svg" alt="Barbarian">
      </div>
      <div class="die-label">Event Die</div>
      <div class="result-text" id="event-result" aria-live="polite"></div>
    </div>
  </div>
  
  <button id="roll-all">Roll All Dice</button>
  
  <div class="swipe-hint">ðŸ’¡ Swipe on a die to roll it individually</div>

  <script>
    // Cryptographically secure uniform random number generator
    function getUniformRandom(max) {
      const range = max;
      const bytesNeeded = Math.ceil(Math.log2(range) / 8);
      const randomBytes = new Uint8Array(bytesNeeded);
      const maxValid = Math.floor(256 ** bytesNeeded / range) * range;
      
      let result;
      do {
        crypto.getRandomValues(randomBytes);
        result = 0;
        for (let i = 0; i < bytesNeeded; i++) {
          result = result * 256 + randomBytes[i];
        }
      } while (result >= maxValid);
      
      return (result % range) + 1;
    }
    
    // Pip configurations for standard dice (1-6)
    const pipConfigs = {
      1: [4],
      2: [0, 8],
      3: [0, 4, 8],
      4: [0, 2, 6, 8],
      5: [0, 2, 4, 6, 8],
      6: [0, 2, 3, 5, 6, 8]
    };
    
    // Event die faces (3 barbarians, 1 each of trade/politics/science)
    const eventFaces = [
      { icon: 'images/ship.svg', name: 'Barbarian' },
      { icon: 'images/ship.svg', name: 'Barbarian' },
      { icon: 'images/ship.svg', name: 'Barbarian' },
      { icon: 'images/trade.png', name: 'Trade' },
      { icon: 'images/politics.png', name: 'Politics' },
      { icon: 'images/science.png', name: 'Science' }
    ];
    
    function renderPips(container, value) {
      container.innerHTML = '';
      const positions = pipConfigs[value];
      for (let i = 0; i < 9; i++) {
        if (positions.includes(i)) {
          const pip = document.createElement('div');
          pip.className = 'pip';
          container.appendChild(pip);
        } else {
          container.appendChild(document.createElement('div'));
        }
      }
    }
    
    function rollDie(dieId, type) {
      const die = document.getElementById(dieId);
      const resultEl = document.getElementById(dieId.replace('-die', '-result'));
      
      die.classList.add('rolling');
      
      // Quick face changes during animation
      const animationInterval = setInterval(() => {
        if (type === 'standard') {
          const randomValue = Math.floor(Math.random() * 6) + 1;
          const pipsContainer = die.querySelector('.pips');
          renderPips(pipsContainer, randomValue);
        } else {
          const randomFace = eventFaces[Math.floor(Math.random() * 6)];
          const eventImg = document.getElementById('event-face');
          eventImg.src = randomFace.icon;
          eventImg.alt = randomFace.name;
        }
      }, 50);
      
      // Final result after animation
      setTimeout(() => {
        clearInterval(animationInterval);
        die.classList.remove('rolling');
        
        if (type === 'standard') {
          const finalValue = getUniformRandom(6);
          const pipsContainer = die.querySelector('.pips');
          renderPips(pipsContainer, finalValue);
          resultEl.textContent = `${dieId.includes('red') ? 'Red' : 'Yellow'} die rolled ${finalValue}`;
        } else {
          const finalIndex = getUniformRandom(6) - 1;
          const finalFace = eventFaces[finalIndex];
          const eventImg = document.getElementById('event-face');
          eventImg.src = finalFace.icon;
          eventImg.alt = finalFace.name;
          resultEl.textContent = `Event die rolled ${finalFace.name}`;
        }
      }, 500);
    }
    
    // Roll all dice function
    function rollAllDice() {
      rollDie('red-die', 'standard');
      setTimeout(() => rollDie('yellow-die', 'standard'), 100);
      setTimeout(() => rollDie('event-die', 'event'), 200);
    }
    
    // Touch/swipe handling
    function setupSwipeHandler(dieId, type) {
      const die = document.getElementById(dieId);
      let startX, startY, startTime;
      let isSwipe = false;
      
      // Touch events
      die.addEventListener('touchstart', (e) => {
        e.stopPropagation();
        startX = e.touches[0].clientX;
        startY = e.touches[0].clientY;
        startTime = Date.now();
        isSwipe = false;
      }, { passive: true });
      
      die.addEventListener('touchend', (e) => {
        e.stopPropagation();
        const endX = e.changedTouches[0].clientX;
        const endY = e.changedTouches[0].clientY;
        const endTime = Date.now();
        
        const deltaX = Math.abs(endX - startX);
        const deltaY = Math.abs(endY - startY);
        const deltaTime = endTime - startTime;
        
        // Detect swipe (movement > 30px and quick) or tap
        if ((deltaX > 30 || deltaY > 30) && deltaTime < 300) {
          isSwipe = true;
          rollAllDice();
        } else if (deltaX < 10 && deltaY < 10) {
          // It's a tap - roll all dice
          rollAllDice();
        }
      }, { passive: true });
      
      // Mouse events for desktop
      die.addEventListener('mousedown', (e) => {
        e.stopPropagation();
        startX = e.clientX;
        startY = e.clientY;
        startTime = Date.now();
        isSwipe = false;
      });
      
      die.addEventListener('mouseup', (e) => {
        e.stopPropagation();
        const endX = e.clientX;
        const endY = e.clientY;
        const endTime = Date.now();
        
        const deltaX = Math.abs(endX - startX);
        const deltaY = Math.abs(endY - startY);
        const deltaTime = endTime - startTime;
        
        // Detect swipe (movement > 30px and quick) or click
        if ((deltaX > 30 || deltaY > 30) && deltaTime < 300) {
          isSwipe = true;
          rollAllDice();
        } else if (deltaX < 10 && deltaY < 10) {
          // It's a click - roll all dice
          rollAllDice();
        }
      });
    }
    
    // Initialize dice with starting values
    renderPips(document.getElementById('red-pips'), 1);
    renderPips(document.getElementById('yellow-pips'), 1);
    
    // Setup swipe handlers
    setupSwipeHandler('red-die', 'standard');
    setupSwipeHandler('yellow-die', 'standard');
    setupSwipeHandler('event-die', 'event');
    
    // Roll all button
    document.getElementById('roll-all').addEventListener('click', rollAllDice);
    
    // Set initial accessibility text
    document.getElementById('red-result').textContent = 'Red die showing 1';
    document.getElementById('yellow-result').textContent = 'Yellow die showing 1';
    document.getElementById('event-result').textContent = 'Event die showing Barbarian';
  </script>
</body>
</html>